<!DOCTYPE html>
<html>
<head>
<title>Club Dashboard</title>
<meta charset="UTF-8">
<style>
body{ 
    font-family:Arial; 
    padding:20px; 
    background:#f7fff7;
    background-color: green;

}
h1{text-align:center; margin-bottom:10px;}
.top-controls {
    display:flex;
    gap:10px;
    justify-content:center;
    margin-bottom:18px;
    flex-wrap:wrap;
}
.section{
    background:#e8ffe8;
    padding:20px;
    margin-top:20px;
    border-radius:10px;
    border-left:6px solid rgb(243, 123, 63);
}
.item{
    background:white;
    padding:12px;
    border-radius:8px;
    margin:8px 0;
}
button{
    padding:10px 18px;
    font-size:16px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.btn-primary { background: #c9dcf4; color: #fff; }
.btn-green { background: #f060f7; color: #fff; }
.btn-orange { background: #ff8c00; color: #fff; }
.btn-red { background: #d9534f; color: #fff; }
.btn-purple { background: #f5c4f0; color: #fff; }
.small { font-size:14px; padding:8px 12px; }
.info-row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
</style>
</head>

<body>

<h1>Club Dashboard</h1>

<div class="top-controls">
    <button class="btn-red" onclick="logout()">Logout</button>

    <a href="gameregistration.html"><button class="btn-primary">Register for New Game / Match</button></a>

    <a href="editclub.html"><button class="btn-orange">Edit Club Info</button></a>

    <a href="editplayers.html"><button class="btn-purple">Edit Players</button></a>

    <a href="matchhistory.html"><button class="btn-green">Match History</button></a>
</div>

<div class="section">
    <h2>Club Details</h2>
    <div id="clubDetails"></div>
</div>

<div class="section">
    <h2>Players Registered</h2>
    <div id="playerList"></div>
</div>

<div class="section">
    <h2>Games Selected</h2>
    <div id="games"></div>
</div>

<div class="section">
    <h2>Upcoming Matches</h2>
    <div id="matchList"></div>
</div>

<script>
// Data keys used: clubs, players, fixtures, loggedClub
const loggedClub = localStorage.getItem("loggedClub");

if (!loggedClub) {
    alert("No club is logged in. Redirecting to login.");
    window.location.href = "clublogin.html";
}

// fetch data from storage
let clubs = JSON.parse(localStorage.getItem("clubs")) || [];
let players = JSON.parse(localStorage.getItem("players")) || [];
let fixtures = JSON.parse(localStorage.getItem("fixtures")) || [];

// UTIL: clear containers before rendering
function clearContainers() {
    document.getElementById("clubDetails").innerHTML = "";
    document.getElementById("playerList").innerHTML = "";
    document.getElementById("games").innerHTML = "";
    document.getElementById("matchList").innerHTML = "";
}

// LOGOUT
function logout() {
    localStorage.removeItem("loggedClub");
    alert("Logged out successfully.");
    window.location.href = "clublogin.html";
}

// SHOW CLUB DETAILS
function showClubDetails(){
    const club = clubs.find(c => c.username === loggedClub);
    const target = document.getElementById("clubDetails");
    target.innerHTML = "";

    if (!club) {
        target.innerHTML = "<div class='item'>Club not found.</div>";
        return;
    }

    target.innerHTML = `
        <div class="item"><strong>Club Name:</strong> ${club.username}</div>
        <div class="item"><strong>Email:</strong> ${club.email || '—'}</div>
        <div class="item"><strong>Phone:</strong> ${club.phone || '—'}</div>
    `;
}

// SHOW PLAYERS
function showPlayers(){
    const list = players.filter(p => p.club === loggedClub);
    const container = document.getElementById("playerList");
    container.innerHTML = "";

    if (list.length === 0) {
        container.innerHTML = "<div class='item'>No players registered</div>";
        return;
    }

    // show table-like list with small actions (view)
    list.forEach((p, idx) => {
        container.innerHTML += `
            <div class="item info-row" id="playerRow_${idx}">
                <div style="flex:1">
                    <strong>${p.name}</strong> — <em>${p.game}</em>
                    <div style="font-size:13px; color:#666; margin-top:6px;">
                        Registered on: ${p.registeredAt || 'N/A'}
                    </div>
                </div>
                <div style="display:flex; gap:6px;">
                    <button class="small" onclick="viewPlayer(${idx})">View</button>
                    <button class="small" onclick="editPlayer('${p.name}')">Edit</button>
                    <button class="small" onclick="deletePlayer('${p.name}')">Delete</button>
                </div>
            </div>
        `;
    });
}

// SHOW GAMES (unique)
function showGames(){
    const list = players.filter(p => p.club === loggedClub);
    const games = [...new Set(list.map(p => p.game))];
    const container = document.getElementById("games");
    container.innerHTML = "";

    if (games.length === 0) {
        container.innerHTML = "<div class='item'>No games selected</div>";
        return;
    }

    games.forEach(g => {
        container.innerHTML += `<div class='item'>${g}</div>`;
    });
}

// SHOW MATCHES (upcoming & matches involving this club)
function showMatches(){
    const myMatches = fixtures.filter(f => f.team1Club === loggedClub || f.team2Club === loggedClub);
    const container = document.getElementById("matchList");
    container.innerHTML = "";

    if (myMatches.length === 0) {
        container.innerHTML = "<div class='item'>No upcoming matches.</div>";
        return;
    }

    myMatches.forEach((m, idx) => {
        // Determine opponent and which team is the club's
        const isTeam1 = m.team1Club === loggedClub;
        const opponentName = isTeam1 ? m.team2 : m.team1;
        const opponentClub = isTeam1 ? m.team2Club : m.team1Club;
        const myPlayer = isTeam1 ? m.team1 : m.team2;

        container.innerHTML += `
            <div class='item'>
                <strong>${m.team1} (${m.team1Club})</strong> 
                vs 
                <strong>${m.team2} (${m.team2Club})</strong>
                <div style="margin-top:8px; color:#333;">
                    <strong>Game:</strong> ${m.game} &nbsp; | &nbsp;
                    <strong>Time:</strong> ${m.time || 'TBD'} &nbsp; | &nbsp;
                    <strong>Venue:</strong> ${m.venue || 'TBD'}
                </div>
                <div style="margin-top:8px; font-size:14px; color:#555;">
                    <strong>Your player:</strong> ${myPlayer} &nbsp; | &nbsp;
                    <strong>Opponent:</strong> ${opponentName} (${opponentClub})
                </div>
            </div>
        `;
    });
}

/* Small action helpers (these use existing pages you have) */

// View player details (simple alert or could open a modal)
function viewPlayer(idx) {
    const clubPlayers = players.filter(p => p.club === loggedClub);
    const p = clubPlayers[idx];
    if (!p) return alert("Player not found");
    alert(`Name: ${p.name}\nGame: ${p.game}\nRegistered: ${p.registeredAt || 'N/A'}`);
}

// Edit player -> redirect to edit_players.html (you already have this page)
function editPlayer(name) {
    // to be simple: store the player's name to edit and redirect
    localStorage.setItem("editPlayerName", name);
    window.location.href = "editplayers.html";
}

// Delete player
function deletePlayer(name) {
    if (!confirm("Delete player " + name + " ?")) return;
    const updated = players.filter(p => !(p.name === name && p.club === loggedClub));
    localStorage.setItem("players", JSON.stringify(updated));
    // refresh local array & UI
    players.length = 0;
    Array.prototype.push.apply(players, updated);
    refresh();
    alert("Player deleted.");
}

// Refresh all shown sections
function refresh() {
    // re-read storage (in case edited elsewhere)
    clubs = JSON.parse(localStorage.getItem("clubs")) || [];
    players = JSON.parse(localStorage.getItem("players")) || [];
    fixtures = JSON.parse(localStorage.getItem("fixtures")) || [];

    clearContainers();
    showClubDetails();
    showPlayers();
    showGames();
    showMatches();
}

// initial render
refresh();
</script>

</body>
</html>
